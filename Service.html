<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INSTALLATION & SERVICE MANAGEMENT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Se.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div class="header-buttons">
                    <button class="header-btn" onclick="window.location.href='mainpage.html'">
                        <i class="fas fa-home"></i> Home
                    </button>
                </div>
                <div class="header-buttons">
                    <button class="header-btn" onclick="window.location.href='Installation.html'">
                        <i class="fas fa-tools"></i> Installation
                    </button>
                </div>
            </div>
            <h1><i class="fas fa-cogs"></i> INSTALLATION & SERVICE MANAGEMENT</h1>
            <p class="header-subtitle">Complete service report management system</p>
        </header>
        
        <!-- Stats Overview - Only shown in data tab -->
        <div id="statsContainer" class="stats-container" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalReports">0</div>
                <div class="stat-label">Total Reports</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="openReports">0</div>
                <div class="stat-label">Open Reports</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="warrantyServices">0</div>
                <div class="stat-label">Warranty Services</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="closedThisMonth">0</div>
                <div class="stat-label">Closed This Month</div>
            </div>
        </div>
        
        <!-- Navigation Dropdown -->
        <div class="nav-container">
            <div class="nav-dropdown">
                <select class="nav-select" id="navSelect" onchange="openTab(this.value)">
                    <option value="formTab">New Service Report</option>
                    <option value="dataTab">View Service Reports</option>
                </select>
            </div>
        </div>
        
        <div id="formTab" class="tab-content active">
            <div class="form-container">
                <form id="serviceForm">
                    <input type="hidden" id="recordId" name="id" value="">
                    
                    <!-- Basic Information Section -->
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-info-circle"></i> BASIC INFORMATION</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="date"><i class="fas fa-calendar"></i> DATE <span class="required">*</span></label>
                                <input type="date" id="date" name="date" required>
                            </div>
                            <div class="form-group">
                                <label for="csrNo"><i class="fas fa-hashtag"></i> CSR NO</label>
                                <input type="text" id="csrNo" name="csrNo" readonly>
                            </div>
                            <div class="form-group">
                                <label for="customerName"><i class="fas fa-user"></i> CUSTOMER NAME <span class="required">*</span></label>
                                <input type="text" id="customerName" name="customerName" required>
                            </div>
                            <div class="form-group">
                                <label for="address"><i class="fas fa-map-marker"></i> ADDRESS <span class="required">*</span></label>
                                <textarea id="address" name="address" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="city"><i class="fas fa-city"></i> CITY <span class="required">*</span></label>
                                <input type="text" id="city" name="city" required>
                            </div>
                            <div class="form-group">
                                <label for="contactNo"><i class="fas fa-phone"></i> CONTACT NO <span class="required">*</span></label>
                                <input type="tel" id="contactNo" name="contactNo" required pattern="[0-9]{10,}">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Equipment Details Section -->
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-toolbox"></i> EQUIPMENT DETAILS</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="equipmentName"><i class="fas fa-tools"></i> EQUIPMENT NAME <span class="optional-field">(Optional)</span></label>
                                <input type="text" id="equipmentName" name="equipmentName">
                            </div>
                            <div class="form-group">
                                <label for="serialNo"><i class="fas fa-barcode"></i> SERIAL NO <span class="optional-field">(Optional)</span></label>
                                <input type="text" id="serialNo" name="serialNo">
                            </div>
                            <div class="form-group">
                                <label for="manufacturer"><i class="fas fa-industry"></i> MANUFACTURER <span class="optional-field">(Optional)</span></label>
                                <input type="text" id="manufacturer" name="manufacturer">
                            </div>
                            <div class="form-group">
                                <label for="model"><i class="fas fa-cube"></i> MODEL <span class="optional-field">(Optional)</span></label>
                                <input type="text" id="model" name="model">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Service Details Section -->
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-tools"></i> SERVICE DETAILS</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="customerProblem"><i class="fas fa-exclamation-triangle"></i> CUSTOMER PROBLEM</label>
                                <textarea id="customerProblem" name="customerProblem"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="diagnosisFindings"><i class="fas fa-stethoscope"></i> DIAGNOSIS & FINDINGS</label>
                                <textarea id="diagnosisFindings" name="diagnosisFindings"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="rectification"><i class="fas fa-wrench"></i> RECTIFICATION</label>
                                <textarea id="rectification" name="rectification"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="serviceType"><i class="fas fa-cog"></i> SERVICE TYPE</label>
                                <select id="serviceType" name="serviceType">
                                    <option value="WARRANTY SERVICE">WARRANTY SERVICE</option>
                                    <option value="OUT OF WARRANTY">OUT OF WARRANTY</option>
                                    <option value="PAYABLE SERVICE">PAYABLE SERVICE</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Spares Replaced Section -->
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-cogs"></i> SPARES REPLACED</h2>
                        <table class="spares-table">
                            <thead>
                                <tr>
                                    <th>SPARES</th>
                                    <th>QUANTITY</th>
                                    <th>COST</th>
                                    <th>ACTION</th>
                                </tr>
                            </thead>
                            <tbody id="sparesTableBody">
                                <tr>
                                    <td><input type="text" name="spareName[]" placeholder="Spare part name"></td>
                                    <td><input type="number" name="spareQuantity[]" placeholder="Qty" min="1" class="number-input"></td>
                                    <td><input type="number" name="spareCost[]" placeholder="Cost" min="0" step="0.01" class="number-input"></td>
                                    <td><button type="button" class="delete-btn" onclick="deleteSpareRow(this)"><i class="fas fa-trash"></i></button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="button" class="add-button" onclick="addSpareRow()"><i class="fas fa-plus"></i></button>
                    </div>
                    
                    <!-- Event Handling Section -->
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-calendar-alt"></i> EVENT HANDLING</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="events"><i class="fas fa-calendar"></i> EVENTS [DATE]</label>
                                <input type="date" id="events" name="events">
                            </div>
                            <div class="form-group">
                                <label for="startOfService"><i class="fas fa-play-circle"></i> START OF SERVICE</label>
                                <input type="datetime-local" id="startOfService" name="startOfService">
                            </div>
                            <div class="form-group">
                                <label for="endOfService"><i class="fas fa-stop-circle"></i> END OF SERVICE</label>
                                <input type="datetime-local" id="endOfService" name="endOfService">
                            </div>
                            <div class="form-group">
                                <label for="rootCause"><i class="fas fa-search"></i> ROOT CAUSE</label>
                                <textarea id="rootCause" name="rootCause"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="correctiveAction"><i class="fas fa-tools"></i> CORRECTIVE ACTION</label>
                                <textarea id="correctiveAction" name="correctiveAction"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="preventiveAction"><i class="fas fa-shield-alt"></i> PREVENTIVE ACTION</label>
                                <textarea id="preventiveAction" name="preventiveAction"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Information Section -->
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-info-circle"></i> ADDITIONAL INFORMATION</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="expectedComplaintClosedDate"><i class="fas fa-calendar-check"></i> EXPECTED COMPLAINT CLOSED DATE</label>
                                <input type="date" id="expectedComplaintClosedDate" name="expectedComplaintClosedDate">
                            </div>
                            <div class="form-group">
                                <label for="closedDate"><i class="fas fa-calendar-times"></i> CLOSED DATE</label>
                                <input type="date" id="closedDate" name="closedDate" onchange="updateStatusBasedOnClosedDate()">
                            </div>
                            <div class="form-group">
                                <label for="engineerName"><i class="fas fa-user-cog"></i> ENGINEER NAME <span class="required">*</span></label>
                                <input type="text" id="engineerName" name="engineerName" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> SAVE</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm()"><i class="fas fa-undo"></i> RESET</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div id="dataTab" class="tab-content">
            <h2 class="section-title"><i class="fas fa-database"></i> SERVICE REPORTS</h2>
            
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search by CSR No, Customer, Equipment...">
                <button class="btn btn-info search-button" onclick="searchReports()"><i class="fas fa-search"></i> Search</button>
                <button class="btn btn-warning search-button" onclick="clearSearch()"><i class="fas fa-times"></i> Clear</button>
                <button class="btn btn-success search-button" onclick="loadServiceReports()"><i class="fas fa-sync"></i> Refresh</button>
            </div>
            
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>CSR NO</th>
                            <th>DATE</th>
                            <th>CUSTOMER</th>
                            <th>EQUIPMENT</th>
                            <th>SERVICE TYPE</th>
                            <th>ENGINEER</th>
                            <th>STATUS</th>
                            <th>ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody id="serviceReportsTable">
                        <!-- Data will be loaded dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Modal for viewing details -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-file-alt"></i> <span id="modalTitle">Service Report Details</span></h2>
            </div>
            <div id="modalContent">
                <!-- Details will be loaded here -->
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>

    <!-- SheetDB Info Panel -->
    <button class="toggle-sheetdb" onclick="toggleSheetDBInfo()">
        <i class="fas fa-database"></i>
    </button>
    
    <div id="sheetdbInfo" class="sheetdb-info">
        <h3>SheetDB Fields</h3>
        <ul>
            <li>id</li>
            <li>date</li>
            <li>csrNo</li>
            <li>customerName</li>
            <li>address</li>
            <li>city</li>
            <li>contactNo</li>
            <li>equipmentName</li>
            <li>serialNo</li>
            <li>manufacturer</li>
            <li>model</li>
            <li>customerProblem</li>
            <li>diagnosisFindings</li>
            <li>rectification</li>
            <li>serviceType</li>
            <li>rootCause</li>
            <li>correctiveAction</li>
            <li>preventiveAction</li>
            <li>spareNames</li>
            <li>spareQuantities</li>
            <li>spareCosts</li>
            <li>events</li>
            <li>startOfService</li>
            <li>endOfService</li>
            <li>expectedComplaintClosedDate</li>
            <li>closedDate</li>
            <li>engineerName</li>
        </ul>
        <button class="btn btn-info" onclick="toggleSheetDBInfo()">Close</button>
    </div>

    <script src="Se.js"></script>
</body>
</html>